var e=Object.defineProperty,t=(t,r,a)=>((t,r,a)=>r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[r]=a)(t,"symbol"!=typeof r?r+"":r,a);import{r,a,c as s,R as n}from"./vendor-DKpNccDo.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const r of e)if("childList"===r.type)for(const e of r.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var i={exports:{}},o={},l=r,d=Symbol.for("react.element"),c=Symbol.for("react.fragment"),u=Object.prototype.hasOwnProperty,m=l.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,h={key:!0,ref:!0,__self:!0,__source:!0};function g(e,t,r){var a,s={},n=null,i=null;for(a in void 0!==r&&(n=""+r),void 0!==t.key&&(n=""+t.key),void 0!==t.ref&&(i=t.ref),t)u.call(t,a)&&!h.hasOwnProperty(a)&&(s[a]=t[a]);if(e&&e.defaultProps)for(a in t=e.defaultProps)void 0===s[a]&&(s[a]=t[a]);return{$$typeof:d,type:e,key:n,ref:i,props:s,_owner:m.current}}o.Fragment=c,o.jsx=g,o.jsxs=g,i.exports=o;var f=i.exports,x={},p=a;x.createRoot=p.createRoot,x.hydrateRoot=p.hydrateRoot;const y={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1},b=new Map,v=e=>{const t=b.get(e);return t?Object.fromEntries(Object.entries(t.stores).map(([e,t])=>[e,t.getState()])):{}},w=(e,t={})=>(r,a,s)=>{const{enabled:n,anonymousActionType:i,store:o,...l}=t;let d;try{d=(null!=n?n:"production"!==(y?"production":void 0))&&window.__REDUX_DEVTOOLS_EXTENSION__}catch(f){}if(!d)return e(r,a,s);const{connection:c,...u}=((e,t,r)=>{if(void 0===e)return{type:"untracked",connection:t.connect(r)};const a=b.get(r.name);if(a)return{type:"tracked",store:e,...a};const s={connection:t.connect(r),stores:{}};return b.set(r.name,s),{type:"tracked",store:e,...s}})(o,d,l);let m=!0;s.setState=(e,t,n)=>{const d=r(e,t);if(!m)return d;const u=void 0===n?{type:i||"anonymous"}:"string"==typeof n?{type:n}:n;return void 0===o?(null==c||c.send(u,a()),d):(null==c||c.send({...u,type:`${o}/${u.type}`},{...v(l.name),[o]:s.getState()}),d)};const h=(...e)=>{const t=m;m=!1,r(...e),m=t},g=e(s.setState,a,s);if("untracked"===u.type?null==c||c.init(g):(u.stores[u.store]=s,null==c||c.init(Object.fromEntries(Object.entries(u.stores).map(([e,t])=>[e,e===u.store?g:t.getState()])))),s.dispatchFromDevtools&&"function"==typeof s.dispatch){let e=!1;const t=s.dispatch;s.dispatch=(...r)=>{"production"===(y?"production":void 0)||"__setState"!==r[0].type||e||(e=!0),t(...r)}}return c.subscribe(e=>{var t;switch(e.type){case"ACTION":if("string"!=typeof e.payload)return;return j(e.payload,e=>{if("__setState"===e.type){if(void 0===o)return void h(e.state);Object.keys(e.state).length;const t=e.state[o];if(null==t)return;return void(JSON.stringify(s.getState())!==JSON.stringify(t)&&h(t))}s.dispatchFromDevtools&&"function"==typeof s.dispatch&&s.dispatch(e)});case"DISPATCH":switch(e.payload.type){case"RESET":return h(g),void 0===o?null==c?void 0:c.init(s.getState()):null==c?void 0:c.init(v(l.name));case"COMMIT":return void 0===o?void(null==c||c.init(s.getState())):null==c?void 0:c.init(v(l.name));case"ROLLBACK":return j(e.state,e=>{if(void 0===o)return h(e),void(null==c||c.init(s.getState()));h(e[o]),null==c||c.init(v(l.name))});case"JUMP_TO_STATE":case"JUMP_TO_ACTION":return j(e.state,e=>{void 0!==o?JSON.stringify(s.getState())!==JSON.stringify(e[o])&&h(e[o]):h(e)});case"IMPORT_STATE":{const{nextLiftedState:r}=e.payload,a=null==(t=r.computedStates.slice(-1)[0])?void 0:t.state;if(!a)return;return h(void 0===o?a:a[o]),void(null==c||c.send(null,r))}case"PAUSE_RECORDING":return m=!m}return}}),g},j=(e,t)=>{let r;try{r=JSON.parse(e)}catch(a){}void 0!==r&&t(r)};const k=new class{constructor(){t(this,"isDevelopment",!1)}createEntry(e,t,r,a){return{timestamp:(new Date).toISOString(),level:e,message:t,...r&&{context:r},...a&&{error:{message:a.message,...this.isDevelopment&&{stack:a.stack}}}}}output(e){JSON.stringify(e);"ERROR"===e.level||"WARN"===e.level||"DEBUG"===e.level&&this.isDevelopment}debug(e,t){this.isDevelopment&&this.output(this.createEntry("DEBUG",e,t))}info(e,t){this.output(this.createEntry("INFO",e,t))}warn(e,t){this.output(this.createEntry("WARN",e,t))}error(e,t,r){const a=t instanceof Error,s=a?t:void 0,n=a?r:t;this.output(this.createEntry("ERROR",e,n,s))}};function N(e,t){k.info("Parsing feed",{feedUrl:t,size:e.length});const r=(new DOMParser).parseFromString(e,"text/xml"),a=r.querySelector("parsererror");if(a)throw k.error("XML parser error",{feedUrl:t,error:a.textContent}),new Error(`Failed to parse XML: ${a.textContent}`);const s=function(e){const t=e.documentElement;if("rss"===t.nodeName&&"2.0"===t.getAttribute("version"))return"RSS 2.0";if("feed"===t.nodeName&&"http://www.w3.org/2005/Atom"===t.namespaceURI)return"Atom 1.0";return"Unknown"}(r);if(k.debug("Detected feed format",{feedUrl:t,format:s}),"RSS 2.0"===s)return function(e,t){const r=e.querySelector("channel");if(!r)throw new Error("Invalid RSS 2.0 feed: missing <channel> element");const a=A(r,"title")||"Untitled Feed",s=A(r,"description")||"",n=A(r,"link")||t,i=r.querySelector("image"),o=i?A(i,"url"):void 0,l={url:t,title:a,description:s,link:n,iconUrl:o},d=Array.from(r.querySelectorAll("item")).map(e=>{var t;const r=A(e,"title")||"Untitled",a=A(e,"link")||"",s=A(e,"description")||"",n=e.getElementsByTagNameNS("http://purl.org/rss/1.0/modules/content/","encoded")[0],i=(null==n?void 0:n.textContent)||s,o=e.getElementsByTagNameNS("http://purl.org/dc/elements/1.1/","creator")[0],l=A(e,"author")||(null==(t=null==o?void 0:o.textContent)?void 0:t.trim())||void 0,d=A(e,"pubDate"),c=d?new Date(d):new Date;let u;const m=e.querySelector('enclosure[type^="image"]');return u=m?m.getAttribute("url")||void 0:S(i),{title:r,summary:s,content:i,author:l,imageUrl:u,link:a,publishedAt:c,readAt:null,isFavorite:!1,deletedAt:null}});return k.info("Parsed RSS 2.0 feed",{feedUrl:t,title:a,articleCount:d.length}),{feed:l,articles:d,format:"RSS 2.0"}}(r,t);if("Atom 1.0"===s)return function(e,t){const r=e.documentElement,a=A(r,"title")||"Untitled Feed",s=A(r,"subtitle")||"",n=r.querySelector('link[rel="alternate"]')||r.querySelector("link"),i=(null==n?void 0:n.getAttribute("href"))||t,o=A(r,"icon")||A(r,"logo")||void 0,l={url:t,title:a,description:s,link:i,iconUrl:o},d=Array.from(r.querySelectorAll("entry")).map(e=>{const t=A(e,"title")||"Untitled",r=e.querySelector('link[rel="alternate"]')||e.querySelector("link"),a=(null==r?void 0:r.getAttribute("href"))||"",s=A(e,"summary")||"",n=A(e,"content")||s,i=e.querySelector("author name"),o=(null==i?void 0:i.textContent)||void 0,l=A(e,"published")||A(e,"updated"),d=l?new Date(l):new Date;let c;const u=e.querySelector('media\\:content[medium="image"], [medium="image"]');return c=u?u.getAttribute("url")||void 0:S(n),{title:t,summary:s,content:n,author:o,imageUrl:c,link:a,publishedAt:d,readAt:null,isFavorite:!1,deletedAt:null}});return k.info("Parsed Atom 1.0 feed",{feedUrl:t,title:a,articleCount:d.length}),{feed:l,articles:d,format:"Atom 1.0"}}(r,t);throw new Error("Unsupported feed format. Only RSS 2.0 and Atom 1.0 are supported.")}function A(e,t){var r;const a=e.querySelector(t);return(null==(r=null==a?void 0:a.textContent)?void 0:r.trim())||""}function S(e){const t=e.match(/<img[^>]+src=["']([^"']+)["']/i);return null==t?void 0:t[1]}function E(e){const t=e.trim();if(!t)return null;if(t.match(/^(javascript|data|file):/i))return k.warn("Invalid feed URL protocol",{url:e}),null;let r=t;return r.match(/^https?:\/\//i)||(r=`https://${r}`),r.match(/^https?:\/\/[a-z0-9]+([\-\.]{1}[a-z0-9]+)*\.[a-z]{2,}(:[0-9]{1,5})?(\/.*)?$/i)||r.match(/^https?:\/\/localhost(:[0-9]{1,5})?(\/.*)?$/i)?function(e){try{const t=new URL(e);return"http:"===t.protocol||"https:"===t.protocol}catch{return!1}}(r)?r:(k.warn("Invalid feed URL",{url:e}),null):(k.warn("Invalid feed URL format",{url:e}),null)}const L=new class{constructor(){t(this,"db",null)}async init(){return new Promise((e,t)=>{const r=indexedDB.open("rss-reader",1);r.onerror=()=>{k.error("IndexedDB initialization failed"),t(r.error)},r.onsuccess=()=>{this.db=r.result,k.info("IndexedDB initialized successfully"),e()},r.onupgradeneeded=e=>{const t=e.target.result;if(!t.objectStoreNames.contains("feeds")){const e=t.createObjectStore("feeds",{keyPath:"id"});e.createIndex("categoryId","categoryId",{unique:!1}),e.createIndex("deletedAt","deletedAt",{unique:!1}),e.createIndex("paused","paused",{unique:!1})}if(!t.objectStoreNames.contains("articles")){const e=t.createObjectStore("articles",{keyPath:"id"});e.createIndex("feedId","feedId",{unique:!1}),e.createIndex("publishedAt","publishedAt",{unique:!1}),e.createIndex("readAt","readAt",{unique:!1}),e.createIndex("isFavorite","isFavorite",{unique:!1})}if(!t.objectStoreNames.contains("categories")){t.createObjectStore("categories",{keyPath:"id"}).createIndex("order","order",{unique:!1})}t.objectStoreNames.contains("settings")||t.createObjectStore("settings",{keyPath:"id"}),t.objectStoreNames.contains("syncState")||t.createObjectStore("syncState",{keyPath:"id"}),k.info("Database upgraded to version 1")}})}async put(e,t){return new Promise((r,a)=>{if(!this.db)return void a(new Error("Database not initialized"));const s=this.db.transaction([e],"readwrite").objectStore(e).put(t);s.onerror=()=>a(s.error),s.onsuccess=()=>r(s.result)})}async get(e,t){return new Promise((r,a)=>{if(!this.db)return void a(new Error("Database not initialized"));const s=this.db.transaction([e],"readonly").objectStore(e).get(t);s.onerror=()=>a(s.error),s.onsuccess=()=>r(s.result)})}async getAll(e){return new Promise((t,r)=>{if(!this.db)return void r(new Error("Database not initialized"));const a=this.db.transaction([e],"readonly").objectStore(e).getAll();a.onerror=()=>r(a.error),a.onsuccess=()=>t(a.result)})}async delete(e,t){return new Promise((r,a)=>{if(!this.db)return void a(new Error("Database not initialized"));const s=this.db.transaction([e],"readwrite").objectStore(e).delete(t);s.onerror=()=>a(s.error),s.onsuccess=()=>r()})}async clear(e){return new Promise((t,r)=>{if(!this.db)return void r(new Error("Database not initialized"));const a=this.db.transaction([e],"readwrite").objectStore(e).clear();a.onerror=()=>r(a.error),a.onsuccess=()=>t()})}async bulkPut(e,t){return new Promise((r,a)=>{if(!this.db)return void a(new Error("Database not initialized"));const s=this.db.transaction([e],"readwrite"),n=s.objectStore(e);let i=0;const o=[];t.forEach(e=>{const a=n.put(e);a.onerror=()=>{o.push(a.error)},a.onsuccess=()=>{i++,i===t.length&&(o.length>0&&k.warn("Bulk put completed with errors",{total:t.length,errors:o.length}),r())}}),s.onerror=()=>a(s.error),0===t.length&&r()})}async getQuota(){if("storage"in navigator&&"estimate"in navigator.storage){const e=await navigator.storage.estimate(),t=e.usage||0,r=e.quota||0,a=r>0?t/r*100:0,s=r-t;return k.debug("Storage quota",{usage:t,quota:r,percentUsed:a}),{usage:t,quota:r,percentUsed:a,available:s}}return{usage:0,quota:0,percentUsed:0,available:0}}async isQuotaExceeded(){return(await this.getQuota()).percentUsed>90}async getDatabaseSize(){return(await this.getQuota()).usage}async getAllByIndex(e,t,r){return new Promise((a,s)=>{if(!this.db)return void s(new Error("Database not initialized"));const n=this.db.transaction([e],"readonly").objectStore(e).index(t).getAll(r);n.onerror=()=>s(n.error),n.onsuccess=()=>a(n.result)})}},F=[];for(let ke=0;ke<256;++ke)F.push((ke+256).toString(16).slice(1));let C;const R=new Uint8Array(16);const I={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function D(e,t,r){var a;const s=(e=e||{}).random??(null==(a=e.rng)?void 0:a.call(e))??function(){if(!C){if("undefined"==typeof crypto||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");C=crypto.getRandomValues.bind(crypto)}return C(R)}();if(s.length<16)throw new Error("Random bytes length must be >= 16");return s[6]=15&s[6]|64,s[8]=63&s[8]|128,function(e,t=0){return(F[e[t+0]]+F[e[t+1]]+F[e[t+2]]+F[e[t+3]]+"-"+F[e[t+4]]+F[e[t+5]]+"-"+F[e[t+6]]+F[e[t+7]]+"-"+F[e[t+8]]+F[e[t+9]]+"-"+F[e[t+10]]+F[e[t+11]]+F[e[t+12]]+F[e[t+13]]+F[e[t+14]]+F[e[t+15]]).toLowerCase()}(s)}function U(e,t,r){return I.randomUUID&&!e?I.randomUUID():D(e)}async function O(e){k.info("Fetching feed XML",{url:e});try{const t=e,r=await fetch(t,{headers:{Accept:"application/rss+xml, application/atom+xml, application/xml, text/xml","User-Agent":"RSS-Reader-PWA/1.0"},cache:"no-cache"});if(!r.ok)throw new Error(`HTTP ${r.status}: ${r.statusText}`);let a,s=r.headers.get("content-type");if(a=await r.text(),!function(e,t){if(e){const t=e.toLowerCase();if(["application/rss+xml","application/atom+xml","application/xml","text/xml","application/rdf+xml"].some(e=>t.includes(e)))return!0}const r=t.includes("<rss")&&t.includes("</rss>"),a=t.includes("<feed")&&t.includes("</feed>");return r||a}(s,a))throw new Error("Response does not appear to be an RSS/Atom feed");return{xml:a,contentType:s}}catch(t){throw k.error("Failed to fetch feed",t instanceof Error?t:void 0,{url:e}),t}}async function T(e,t){try{const r=E(e);if(!r)return{success:!1,error:"Invalid feed URL"};const a=await L.getAll("feeds");if(a.find(e=>e.url===r&&!e.deletedAt))return k.warn("Feed already exists",{url:r}),{success:!1,error:"You are already subscribed to this feed"};const{xml:s}=await O(r),n=N(s,r),i={id:U(),url:r,title:n.feed.title,description:n.feed.description||"",link:n.feed.link,iconUrl:n.feed.iconUrl,categoryId:t,lastFetchedAt:new Date,refreshIntervalMinutes:60,paused:!1,errorCount:0,createdAt:new Date,deletedAt:null},o=n.articles.map(e=>({id:U(),feedId:i.id,title:e.title,summary:e.summary,content:e.content,author:e.author,imageUrl:e.imageUrl,link:e.link,publishedAt:e.publishedAt,readAt:null,isFavorite:!1,createdAt:new Date,deletedAt:null}));return await L.put("feeds",i),await L.bulkPut("articles",o),k.info("Subscribed to feed",{feedId:i.id,title:i.title,articleCount:o.length}),{success:!0,feed:i,articles:o}}catch(r){return k.error("Failed to subscribe to feed",r instanceof Error?r:void 0,{url:e}),{success:!1,error:r instanceof Error?r.message:"Failed to subscribe to feed"}}}async function M(e,t={}){const{limit:r,includeDeleted:a=!1}=t;if(!a){const t=await L.get("feeds",e);if(!t||t.deletedAt)return[]}let s=await L.getAllByIndex("articles","feedId",e);return s.sort((e,t)=>{const r=new Date(e.publishedAt).getTime();return new Date(t.publishedAt).getTime()-r}),r&&(s=s.slice(0,r)),s}async function _(e){const t=await L.get("articles",e);if(!t)throw new Error("Article not found");t.readAt||(t.readAt=new Date,await L.put("articles",t),k.debug("Marked article as read",{articleId:e}))}async function P(e){const t=await L.get("feeds",e);if(!t)throw new Error("Feed not found");if(t.paused)return k.debug("Feed is paused, skipping refresh",{feedId:e}),[];try{const{xml:r}=await O(t.url),a=N(r,t.url),s=await L.getAllByIndex("articles","feedId",e),n=new Set(s.map(e=>e.link)),i=a.articles.filter(e=>!n.has(e.link)).map(e=>({id:U(),feedId:t.id,title:e.title,summary:e.summary,content:e.content,author:e.author,imageUrl:e.imageUrl,link:e.link,publishedAt:e.publishedAt,readAt:null,isFavorite:!1,createdAt:new Date,deletedAt:null}));return i.length>0&&await L.bulkPut("articles",i),t.lastFetchedAt=new Date,t.errorCount=0,await L.put("feeds",t),k.info("Fetched articles for feed",{feedId:e,newCount:i.length}),i}catch(r){throw t.errorCount++,t.lastFetchedAt=new Date,await L.put("feeds",t),k.error("Failed to refresh feed",{feedId:e,error:r}),r}}const q=Object.freeze(Object.defineProperty({__proto__:null,fetchAndStoreArticles:P,fetchFeedXML:O,getArticlesForFeed:M,markArticleAsRead:_,subscribeFeed:T},Symbol.toStringTag,{value:"Module"})),B={},z=function(e,t,r){let a=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const e=document.querySelector("meta[property=csp-nonce]"),r=(null==e?void 0:e.nonce)||(null==e?void 0:e.getAttribute("nonce"));a=Promise.allSettled(t.map(e=>{if((e=function(e){return"/"+e}(e))in B)return;B[e]=!0;const t=e.endsWith(".css"),a=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${a}`))return;const s=document.createElement("link");return s.rel=t?"stylesheet":"modulepreload",t||(s.as="script"),s.crossOrigin="",s.href=e,r&&s.setAttribute("nonce",r),document.head.appendChild(s),t?new Promise((t,r)=>{s.addEventListener("load",t),s.addEventListener("error",()=>r(new Error(`Unable to preload CSS for ${e}`)))}):void 0}))}function s(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return a.then(t=>{for(const e of t||[])"rejected"===e.status&&s(e.reason);return e().catch(s)})};const $=new class{constructor(){t(this,"refreshTimer",null),t(this,"isRefreshing",!1)}async startAutoRefresh(e=60){k.info("Starting auto-refresh",{intervalMinutes:e}),null!==this.refreshTimer&&clearTimeout(this.refreshTimer),await this.refreshAllFeeds(),this.scheduleNextRefresh(e)}scheduleNextRefresh(e){const t=60*e*1e3;this.refreshTimer=window.setTimeout(async()=>{await this.refreshAllFeeds(),this.scheduleNextRefresh(e)},t),k.debug("Next refresh scheduled",{intervalMinutes:e})}async refreshAllFeeds(){if(this.isRefreshing)k.debug("Refresh already in progress, skipping");else{this.isRefreshing=!0,k.info("Refreshing all feeds");try{await this.updateSyncState(!0);const e=(await L.getAll("feeds")).filter(e=>!e.deletedAt&&!e.paused);k.info("Refreshing active feeds",{count:e.length});const t=5;for(let r=0;r<e.length;r+=t){const a=e.slice(r,r+t);await Promise.allSettled(a.map(e=>this.refreshFeed(e.id)))}await this.updateSyncState(!1),k.info("Feed refresh completed")}catch(e){k.error("Feed refresh failed",{error:e}),await this.updateSyncState(!1)}finally{this.isRefreshing=!1}}}async refreshFeed(e){try{k.debug("Refreshing feed",{feedId:e}),await P(e)}catch(t){k.warn("Failed to refresh feed",{feedId:e,error:t})}}async updateSyncState(e){const t={id:"default",isSyncing:e,lastSyncAt:e?null:new Date,queuedOperations:[]};await L.put("syncState",t)}async queueOperation(e){k.info("Queueing operation",{type:e.type});let t=await L.get("syncState","default");t||(t={id:"default",isSyncing:!1,lastSyncAt:null,queuedOperations:[]}),t.queuedOperations.push(e),await L.put("syncState",t)}async processQueuedOperations(){k.info("Processing queued operations");const e=await L.get("syncState","default");if(!e||0===e.queuedOperations.length)return void k.debug("No queued operations");const t=[...e.queuedOperations];e.queuedOperations=[],await L.put("syncState",e);for(const a of t)try{await this.executeOperation(a),k.debug("Executed queued operation",{type:a.type})}catch(r){k.error("Failed to execute queued operation",{operation:a,error:r})}}async executeOperation(e){var t,r;switch(k.debug("Executing operation",{type:e.type,data:e.data}),e.type){case"ADD_FEED":if(null==(t=e.data)?void 0:t.url){const{subscribeFeed:t}=await z(async()=>{const{subscribeFeed:e}=await Promise.resolve().then(()=>q);return{subscribeFeed:e}},void 0);await t(e.data.url,e.data.categoryId)}break;case"REFRESH_FEED":if(null==(r=e.data)?void 0:r.feedId){const{fetchAndStoreArticles:t}=await z(async()=>{const{fetchAndStoreArticles:e}=await Promise.resolve().then(()=>q);return{fetchAndStoreArticles:e}},void 0);await t(e.data.feedId)}break;case"UPDATE_FEED":k.debug("Feed update already processed locally");break;default:k.warn("Unknown operation type",{type:e.type})}}stopAutoRefresh(){null!==this.refreshTimer&&(clearTimeout(this.refreshTimer),this.refreshTimer=null,k.info("Auto-refresh stopped"))}},W=s()(w((e,t)=>({feeds:[],articles:[],categories:[],selectedFeedId:null,selectedArticleId:null,settings:null,syncState:null,isLoading:!1,error:null,isAddFeedDialogOpen:!1,loadFeeds:async()=>{try{e({isLoading:!0,error:null});const t=(await L.getAll("feeds")).filter(e=>!e.deletedAt);e({feeds:t,isLoading:!1}),k.info("Loaded feeds",{count:t.length})}catch(t){k.error("Failed to load feeds",t instanceof Error?t:void 0),e({error:"Failed to load feeds",isLoading:!1})}},subscribeFeed:async(r,a)=>{e({isLoading:!0,error:null});const s=await T(r,a);if(s.success&&s.feed){const{feeds:r}=t();return e({feeds:[...r,s.feed],isLoading:!1,isAddFeedDialogOpen:!1}),k.info("Feed subscribed",{feedId:s.feed.id}),{success:!0}}return e({error:s.error||"Failed to subscribe",isLoading:!1}),{success:!1,error:s.error}},selectFeed:async r=>{e({selectedFeedId:r,selectedArticleId:null}),r?await t().loadArticles(r):e({articles:[]})},unsubscribeFeed:async r=>{try{const a=await L.get("feeds",r);if(a){a.deletedAt=new Date,await L.put("feeds",a);const{feeds:s}=t();e({feeds:s.filter(e=>e.id!==r)}),k.info("Feed unsubscribed",{feedId:r})}}catch(a){k.error("Failed to unsubscribe feed",a instanceof Error?a:void 0,{feedId:r}),e({error:"Failed to unsubscribe from feed"})}},refreshAllFeeds:async()=>{try{e({isLoading:!0,error:null}),await $.refreshAllFeeds(),await t().loadFeeds();const{selectedFeedId:r}=t();r&&await t().loadArticles(r),e({isLoading:!1}),k.info("All feeds refreshed")}catch(r){k.error("Failed to refresh feeds",r instanceof Error?r:void 0),e({error:"Failed to refresh feeds",isLoading:!1})}},updateFeed:async(r,a)=>{try{const s=await L.get("feeds",r);if(!s)throw new Error("Feed not found");Object.assign(s,a),await L.put("feeds",s);const n=t().feeds.map(e=>e.id===r?s:e);e({feeds:n}),k.info("Updated feed",{feedId:r})}catch(s){throw k.error("Failed to update feed",s instanceof Error?s:void 0),s}},toggleFeedPause:async r=>{try{const a=await L.get("feeds",r);if(!a)return;a.paused=!a.paused,await L.put("feeds",a);const s=t().feeds.map(e=>e.id===r?a:e);e({feeds:s}),k.info("Toggled feed pause",{feedId:r,paused:a.paused})}catch(a){k.error("Failed to toggle feed pause",a instanceof Error?a:void 0)}},loadArticles:async t=>{try{e({isLoading:!0,error:null});const r=await M(t);e({articles:r,isLoading:!1}),k.info("Loaded articles",{feedId:t,count:r.length})}catch(r){k.error("Failed to load articles",r instanceof Error?r:void 0,{feedId:t}),e({error:"Failed to load articles",isLoading:!1})}},selectArticle:async r=>{e({selectedArticleId:r}),r&&await t().markArticleAsRead(r)},markArticleAsRead:async r=>{try{await _(r);const{articles:a}=t(),s=a.map(e=>e.id===r?{...e,readAt:new Date}:e);e({articles:s})}catch(a){k.error("Failed to mark article as read",a instanceof Error?a:void 0,{articleId:r})}},toggleArticleFavorite:async r=>{try{const a=await L.get("articles",r);if(!a)return;a.isFavorite=!a.isFavorite,await L.put("articles",a);const s=t().articles.map(e=>e.id===r?{...e,isFavorite:a.isFavorite}:e);e({articles:s}),k.info("Toggled favorite",{articleId:r,isFavorite:a.isFavorite})}catch(a){k.error("Failed to toggle favorite",a instanceof Error?a:void 0)}},markAllAsRead:async r=>{try{const a=await L.getAll("articles"),s=r?a.filter(e=>e.feedId===r&&!e.readAt):a.filter(e=>!e.readAt);for(const e of s)e.readAt=new Date,await L.put("articles",e);const n=t().articles.map(e=>s.some(t=>t.id===e.id)?{...e,readAt:new Date}:e);e({articles:n}),k.info("Marked all as read",{count:s.length})}catch(a){k.error("Failed to mark all as read",a instanceof Error?a:void 0)}},loadCategories:async()=>{try{const t=await L.getAll("categories");e({categories:t}),k.info("Loaded categories",{count:t.length})}catch(t){k.error("Failed to load categories",t instanceof Error?t:void 0)}},createCategory:async r=>{try{const a=t().categories,s={id:crypto.randomUUID(),name:r,order:a.length,createdAt:new Date};await L.put("categories",s),e({categories:[...a,s]}),k.info("Created category",{name:r})}catch(a){throw k.error("Failed to create category",a instanceof Error?a:void 0),a}},updateCategory:async(r,a)=>{try{const s=await L.get("categories",r);if(!s)throw new Error("Category not found");s.name=a,await L.put("categories",s);const n=t().categories.map(e=>e.id===r?s:e);e({categories:n}),k.info("Updated category",{id:r,name:a})}catch(s){throw k.error("Failed to update category",s instanceof Error?s:void 0),s}},deleteCategory:async r=>{try{const a=t().feeds;for(const e of a.filter(e=>e.categoryId===r))e.categoryId=void 0,await L.put("feeds",e);await L.delete("categories",r);const s=t().categories.filter(e=>e.id!==r);e({categories:s,feeds:a.map(e=>e.categoryId===r?{...e,categoryId:void 0}:e)}),k.info("Deleted category",{id:r})}catch(a){throw k.error("Failed to delete category",a instanceof Error?a:void 0),a}},loadSettings:async()=>{try{const t=await L.get("settings","default");e({settings:t}),k.info("Loaded settings")}catch(t){k.error("Failed to load settings",t instanceof Error?t:void 0)}},updateSettings:async t=>{try{await L.put("settings",t),e({settings:t}),t.enableBackgroundSync&&t.defaultRefreshIntervalMinutes>0?await $.startAutoRefresh(t.defaultRefreshIntervalMinutes):$.stopAutoRefresh(),k.info("Settings updated",{settings:t})}catch(r){k.error("Failed to update settings",r instanceof Error?r:void 0),e({error:"Failed to save settings"})}},loadSyncState:async()=>{try{const t=await L.get("syncState","default");e({syncState:t}),k.info("Loaded sync state")}catch(t){k.error("Failed to load sync state",t instanceof Error?t:void 0)}},setError:t=>{e({error:t})},openAddFeedDialog:()=>{e({isAddFeedDialogOpen:!0,error:null})},closeAddFeedDialog:()=>{e({isAddFeedDialogOpen:!1,error:null})}}),{name:"RSS Reader Store"})),H="rss-reader-theme";function Q(e){return"system"===e?"undefined"==typeof window?"light":window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":e}function V(e){const t=document.documentElement;"dark"===e?t.classList.add("dark"):t.classList.remove("dark"),k.debug("Applied theme",{theme:e})}function X(){const[e,t]=r.useState(()=>localStorage.getItem(H)||"system"),[a,s]=r.useState(()=>Q(e));r.useEffect(()=>{const t=window.matchMedia("(prefers-color-scheme: dark)"),r=t=>{if("system"===e){const e=t.matches?"dark":"light";s(e),V(e),k.info("System theme changed",{theme:e})}};return t.addEventListener?(t.addEventListener("change",r),()=>t.removeEventListener("change",r)):t.addListener?(t.addListener(r),()=>t.removeListener(r)):void 0},[e]),r.useEffect(()=>{const t=Q(e);s(t),V(t)},[e]);const n=e=>{t(e),"system"===e?localStorage.removeItem(H):localStorage.setItem(H,e),k.info("Theme changed",{theme:e})};return{theme:e,resolvedTheme:a,effectiveTheme:a,setTheme:n,toggleTheme:()=>{n("light"===a?"dark":"light")}}}function J(){const[e,t]=r.useState(()=>"undefined"==typeof navigator||navigator.onLine);return r.useEffect(()=>{const e=()=>{t(!0),k.info("Network connection restored")},r=()=>{t(!1),k.warn("Network connection lost")};return t(navigator.onLine),window.addEventListener("online",e),window.addEventListener("offline",r),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",r)}},[]),{isOnline:e}}function Y(e){const t=(new Date).getTime()-e.getTime(),r=Math.floor(t/1e3),a=Math.floor(r/60),s=Math.floor(a/60),n=Math.floor(s/24),i=Math.floor(n/7),o=Math.floor(n/30),l=Math.floor(n/365);return r<60?"just now":a<60?`${a} ${1===a?"minute":"minutes"} ago`:s<24?`${s} ${1===s?"hour":"hours"} ago`:n<7?`${n} ${1===n?"day":"days"} ago`:i<4?`${i} ${1===i?"week":"weeks"} ago`:o<12?`${o} ${1===o?"month":"months"} ago`:`${l} ${1===l?"year":"years"} ago`}function G({feed:e,articleCount:t,onClick:r}){return f.jsxs("article",{className:"group cursor-pointer rounded-xl border border-gray-200 bg-white p-5 shadow-sm transition-all hover:border-primary hover:shadow-md dark:border-gray-700 dark:bg-gray-800 dark:hover:border-primary",onClick:r,children:[f.jsxs("div",{className:"mb-3 flex items-start gap-3",children:[e.imageUrl&&f.jsx("img",{src:e.imageUrl,alt:`${e.title} logo`,className:"h-12 w-12 shrink-0 rounded-lg object-cover",loading:"lazy"}),f.jsxs("div",{className:"min-w-0 flex-1",children:[f.jsx("h3",{className:"mb-1 truncate text-lg font-semibold text-gray-900 group-hover:text-primary dark:text-gray-100 dark:group-hover:text-primary",children:e.title}),e.description&&f.jsx("p",{className:"line-clamp-2 text-sm text-gray-600 dark:text-gray-400",children:e.description})]})]}),f.jsxs("div",{className:"flex items-center gap-4 text-xs text-gray-500 dark:text-gray-500",children:[f.jsxs("span",{className:"flex items-center gap-1",children:[f.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:f.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),t," ",1===t?"article":"articles"]}),e.lastFetchedAt&&f.jsxs("span",{className:"flex items-center gap-1",title:`Last refreshed: ${new Date(e.lastFetchedAt).toLocaleString()}`,children:[f.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:f.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),Y(new Date(e.lastFetchedAt))]})]})]})}function K({message:e,size:t="md"}){return f.jsxs("div",{className:"flex flex-col items-center justify-center gap-3 p-8",children:[f.jsx("div",{className:`${{sm:"h-4 w-4 border-2",md:"h-8 w-8 border-3",lg:"h-12 w-12 border-4"}[t]} animate-spin rounded-full border-primary border-t-transparent`,role:"status","aria-label":"Loading"}),e&&f.jsx("p",{className:"text-sm text-secondary",children:e})]})}function Z({message:e,onDismiss:t}){return f.jsxs("div",{className:"flex items-start gap-3 rounded-lg border border-red-200 bg-red-50 p-4 dark:border-red-800 dark:bg-red-900/20",role:"alert",children:[f.jsx("svg",{className:"h-5 w-5 shrink-0 text-red-600 dark:text-red-400",fill:"currentColor",viewBox:"0 0 20 20","aria-hidden":"true",children:f.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})}),f.jsx("p",{className:"flex-1 text-sm text-red-800 dark:text-red-200",children:e}),t&&f.jsx("button",{onClick:t,className:"shrink-0 text-red-600 hover:text-red-800 dark:text-red-400 dark:hover:text-red-200","aria-label":"Dismiss error",children:f.jsx("svg",{className:"h-5 w-5",fill:"currentColor",viewBox:"0 0 20 20",children:f.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]})}function ee({isOpen:e,onClose:t}){const[a,s]=r.useState(""),[n,i]=r.useState(""),[o,l]=r.useState(""),[d,c]=r.useState(!1),{subscribeFeed:u,categories:m,loadCategories:h}=W(),{isOnline:g}=J();r.useState(()=>{h()});const x=()=>{s(""),i(""),l(""),t()};return e?f.jsxs(f.Fragment,{children:[f.jsx("div",{className:"fixed inset-0 z-40 bg-black/50 backdrop-blur-sm",onClick:x,"aria-hidden":"true"}),f.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:f.jsxs("div",{className:"w-full max-w-md rounded-xl bg-white p-6 shadow-xl dark:bg-gray-800",role:"dialog","aria-modal":"true","aria-labelledby":"dialog-title",children:[f.jsx("h2",{id:"dialog-title",className:"mb-4 text-xl font-semibold text-gray-900 dark:text-gray-100",children:"Add RSS Feed"}),f.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),l(""),g)if(a.trim()){try{new URL(a)}catch{return void l("Please enter a valid URL")}c(!0);try{await u(a.trim(),n||void 0),s(""),i(""),l(""),t()}catch(r){l(r instanceof Error?r.message:"Failed to add feed")}finally{c(!1)}}else l("Please enter a feed URL");else l("Cannot add feeds while offline. Please check your connection.")},className:"space-y-4",children:[f.jsxs("div",{children:[f.jsx("label",{htmlFor:"feed-url",className:"mb-1 block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Feed URL"}),f.jsx("input",{id:"feed-url",type:"text",value:a,onChange:e=>s(e.target.value),placeholder:"https://example.com/feed.xml",className:"w-full rounded-lg border border-gray-300 bg-white px-4 py-2 text-gray-900 focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-100 dark:focus:border-primary",disabled:d,autoFocus:!0})]}),f.jsxs("div",{children:[f.jsx("label",{htmlFor:"category",className:"mb-1 block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Category (Optional)"}),f.jsxs("select",{id:"category",value:n,onChange:e=>i(e.target.value),className:"w-full rounded-lg border border-gray-300 bg-white px-4 py-2 text-gray-900 focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-100 dark:focus:border-primary",disabled:d,children:[f.jsx("option",{value:"",children:"No category"}),m.map(e=>f.jsx("option",{value:e.id,children:e.name},e.id))]})]}),o&&f.jsx("div",{className:"rounded-lg border border-red-200 bg-red-50 p-3 text-sm text-red-800 dark:border-red-800 dark:bg-red-900/20 dark:text-red-200",children:o}),!g&&f.jsx("div",{className:"rounded-lg border border-yellow-200 bg-yellow-50 p-3 text-sm text-yellow-800 dark:border-yellow-800 dark:bg-yellow-900/20 dark:text-yellow-200",children:"⚠️ You're currently offline. Connect to the internet to add new feeds."}),f.jsxs("div",{className:"flex gap-3 pt-2",children:[f.jsx("button",{type:"button",onClick:x,disabled:d,className:"flex-1 rounded-lg border border-gray-300 bg-white px-4 py-2 font-medium text-gray-700 hover:bg-gray-50 disabled:opacity-50 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600",children:"Cancel"}),f.jsx("button",{type:"submit",disabled:d||!g,className:"flex-1 rounded-lg bg-primary px-4 py-2 font-medium text-white hover:bg-primary/90 disabled:opacity-50 disabled:cursor-not-allowed",title:g?"":"Cannot add feeds while offline",children:d?"Adding...":"Add Feed"})]})]})]})})]}):null}function te({selectedCategory:e,onSelectCategory:t,onCreateCategory:r}){const{categories:a,feeds:s}=W();return s.filter(e=>!e.categoryId&&!e.deletedAt).length,f.jsx("aside",{className:"w-64 border-r border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 overflow-y-auto hidden lg:block",children:f.jsxs("div",{className:"p-4",children:[f.jsxs("div",{className:"flex items-center justify-between mb-4",children:[f.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:"分类"}),f.jsx("button",{onClick:r,className:"p-1 rounded hover:bg-gray-100 dark:hover:bg-gray-700",children:f.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:f.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})})})]}),f.jsxs("nav",{className:"space-y-1",children:[f.jsxs("button",{onClick:()=>t(null),className:"w-full flex items-center justify-between px-3 py-2 text-sm rounded-lg "+(null===e?"bg-primary/10 text-primary":"hover:bg-gray-100 dark:hover:bg-gray-700"),children:[f.jsx("span",{children:"全部订阅"}),f.jsx("span",{className:"text-xs",children:s.filter(e=>!e.deletedAt).length})]}),a.map(r=>{return f.jsxs("button",{onClick:()=>t(r.id),className:"w-full flex items-center justify-between px-3 py-2 text-sm rounded-lg truncate "+(e===r.id?"bg-primary/10 text-primary":"hover:bg-gray-100 dark:hover:bg-gray-700"),children:[f.jsx("span",{className:"truncate",children:r.name}),f.jsx("span",{className:"text-xs shrink-0 ml-2",children:(a=r.id,s.filter(e=>e.categoryId===a&&!e.deletedAt).length)})]},r.id);var a})]})]})})}function re({isOpen:e,onClose:t}){const[a,s]=r.useState(""),[n,i]=r.useState(""),{createCategory:o}=W();if(!e)return null;return f.jsxs(f.Fragment,{children:[f.jsx("div",{className:"fixed inset-0 z-40 bg-black/50",onClick:t}),f.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:f.jsxs("div",{className:"w-full max-w-md rounded-xl bg-white dark:bg-gray-800 p-6 shadow-xl",children:[f.jsx("h2",{className:"mb-4 text-xl font-semibold",children:"新建分类"}),f.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),i(""),a.trim())try{await o(a.trim()),s(""),t()}catch(r){i("创建失败，请重试")}else i("请输入分类名称")},className:"space-y-4",children:[f.jsx("div",{children:f.jsx("input",{type:"text",value:a,onChange:e=>s(e.target.value),placeholder:"分类名称",className:"w-full rounded-lg border px-4 py-2 focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:border-gray-600",autoFocus:!0})}),n&&f.jsx("div",{className:"rounded-lg border border-red-200 bg-red-50 p-3 text-sm text-red-800 dark:bg-red-900/20 dark:text-red-200",children:n}),f.jsxs("div",{className:"flex gap-3",children:[f.jsx("button",{type:"button",onClick:t,className:"flex-1 rounded-lg border px-4 py-2 hover:bg-gray-50 dark:border-gray-600 dark:hover:bg-gray-700",children:"取消"}),f.jsx("button",{type:"submit",className:"flex-1 rounded-lg bg-primary px-4 py-2 text-white hover:bg-primary/90",children:"创建"})]})]})]})})]})}function ae(){const[e,t]=r.useState(!1),[a,s]=r.useState(null),[n,i]=r.useState(!1),{feeds:o,articles:l,isLoading:d,error:c,isAddFeedDialogOpen:u,syncState:m,selectFeed:h,setError:g,openAddFeedDialog:x,closeAddFeedDialog:p,refreshAllFeeds:y,loadSyncState:b}=W(),v=(null==m?void 0:m.isSyncing)||e,w=null===a?o.filter(e=>!e.deletedAt):"uncategorized"===a?o.filter(e=>!e.categoryId&&!e.deletedAt):o.filter(e=>e.categoryId===a&&!e.deletedAt);return f.jsxs("div",{className:"flex h-full",children:[f.jsx(te,{selectedCategory:a,onSelectCategory:s,onCreateCategory:()=>i(!0)}),f.jsx("div",{className:"flex-1 overflow-y-auto",children:f.jsxs("div",{className:"mx-auto max-w-7xl px-4 py-8 sm:px-6 lg:px-8",children:[f.jsxs("div",{className:"mb-8 flex items-center justify-between gap-2",children:[f.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-gray-100",children:"My Feeds"}),f.jsxs("div",{className:"flex gap-2",children:[f.jsxs("button",{onClick:async()=>{t(!0);try{await y(),await b()}catch(e){g("刷新失败,请重试")}finally{t(!1)}},disabled:v,className:"flex items-center gap-2 rounded-lg bg-gray-200 dark:bg-gray-700 px-3 py-2 font-medium text-gray-900 dark:text-white hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:"刷新所有订阅源",children:[f.jsx("svg",{className:"h-5 w-5 "+(v?"animate-spin":""),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:f.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),f.jsx("span",{className:"hidden sm:inline",children:v?"刷新中...":"刷新"})]}),f.jsxs("button",{onClick:x,className:"flex items-center gap-2 rounded-lg bg-primary px-4 py-2 font-medium text-white hover:bg-primary/90 transition-colors",children:[f.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:f.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),f.jsx("span",{className:"hidden sm:inline",children:"Add Feed"})]})]})]}),c&&f.jsx("div",{className:"mb-6",children:f.jsx(Z,{message:c,onDismiss:()=>g(null)})}),d&&f.jsx(K,{message:"Loading feeds..."}),!d&&0===o.length&&f.jsxs("div",{className:"flex flex-col items-center justify-center py-16 text-center",children:[f.jsx("svg",{className:"mb-4 h-16 w-16 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:f.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M6 5c7.18 0 13 5.82 13 13M6 11a7 7 0 017 7m-6 0a1 1 0 11-2 0 1 1 0 012 0z"})}),f.jsx("h2",{className:"mb-2 text-xl font-semibold text-gray-900 dark:text-gray-100",children:"No feeds yet"}),f.jsx("p",{className:"mb-6 text-gray-600 dark:text-gray-400",children:"Get started by adding your first RSS feed"}),f.jsx("button",{onClick:x,className:"rounded-lg bg-primary px-6 py-3 font-medium text-white hover:bg-primary/90 transition-colors",children:"Add Your First Feed"})]}),!d&&w.length>0&&f.jsx("div",{className:"grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3",children:w.map(e=>{return f.jsx(G,{feed:e,articleCount:(t=e.id,l.filter(e=>e.feedId===t&&!e.deletedAt).length),onClick:()=>(e=>{h(e)})(e.id)},e.id);var t})}),f.jsx(ee,{isOpen:u,onClose:p}),f.jsx(re,{isOpen:n,onClose:()=>i(!1)})]})})]})}function se({article:e,onClick:t}){const{isOnline:r}=J(),a=!e.readAt,s=new Date(e.publishedAt),n=s.toDateString()===(new Date).toDateString()?s.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"}):s.toLocaleDateString("en-US",{month:"short",day:"numeric"});return f.jsx("article",{className:"group cursor-pointer border-b border-gray-200 px-4 py-4 transition-colors hover:bg-gray-50 dark:border-gray-700 dark:hover:bg-gray-800/50 "+(a?"bg-blue-50/30 dark:bg-blue-900/10":""),onClick:t,children:f.jsxs("div",{className:"flex items-start gap-4",children:[a&&f.jsx("div",{className:"mt-2 h-2 w-2 shrink-0 rounded-full bg-primary","aria-label":"Unread"}),f.jsxs("div",{className:"min-w-0 flex-1",children:[f.jsx("h3",{className:"mb-1 line-clamp-2 text-base font-semibold group-hover:text-primary "+(a?"text-gray-900 dark:text-gray-100":"text-gray-700 dark:text-gray-300"),children:e.title}),e.summary&&f.jsx("p",{className:"mb-2 line-clamp-2 text-sm text-gray-600 dark:text-gray-400",children:e.summary}),f.jsxs("div",{className:"flex items-center gap-3 text-xs text-gray-500 dark:text-gray-500",children:[e.author&&f.jsx("span",{className:"truncate",children:e.author}),f.jsx("span",{children:n}),!r&&f.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-green-100 dark:bg-green-900/30 px-2 py-0.5 text-green-700 dark:text-green-300",children:[f.jsx("svg",{className:"h-3 w-3",fill:"currentColor",viewBox:"0 0 20 20",children:f.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),"Cached"]})]})]}),e.imageUrl&&f.jsx("img",{src:e.imageUrl,alt:"",className:"h-20 w-20 shrink-0 rounded-lg object-cover",loading:"lazy"})]})})}function ne(){const{articles:e,selectedFeedId:t,feeds:r,isLoading:a,error:s,selectArticle:n,selectFeed:i,setError:o}=W(),l=r.find(e=>e.id===t),d=t?e.filter(e=>e.feedId===t&&!e.deletedAt).sort((e,t)=>new Date(t.publishedAt).getTime()-new Date(e.publishedAt).getTime()):[];return f.jsxs("div",{className:"flex h-full flex-col",children:[l&&f.jsx("div",{className:"border-b border-gray-200 bg-white px-6 py-4 dark:border-gray-700 dark:bg-gray-800",children:f.jsxs("div",{className:"flex items-center gap-3",children:[f.jsx("button",{onClick:()=>{i(null)},className:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors tablet:hidden",title:"返回订阅源列表",children:f.jsx("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:f.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),l.imageUrl&&f.jsx("img",{src:l.imageUrl,alt:`${l.title} logo`,className:"h-10 w-10 rounded-lg object-cover"}),f.jsxs("div",{children:[f.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-gray-100",children:l.title}),f.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[d.length," ",1===d.length?"article":"articles"]})]})]})}),s&&f.jsx("div",{className:"p-4",children:f.jsx(Z,{message:s,onDismiss:()=>o(null)})}),a&&f.jsx(K,{message:"Loading articles..."}),!a&&!t&&f.jsxs("div",{className:"flex flex-1 flex-col items-center justify-center p-8 text-center",children:[f.jsx("svg",{className:"mb-4 h-16 w-16 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:f.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),f.jsx("h2",{className:"mb-2 text-xl font-semibold text-gray-900 dark:text-gray-100",children:"No feed selected"}),f.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Select a feed to view its articles"})]}),!a&&t&&0===d.length&&f.jsxs("div",{className:"flex flex-1 flex-col items-center justify-center p-8 text-center",children:[f.jsx("svg",{className:"mb-4 h-16 w-16 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:f.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"})}),f.jsx("h2",{className:"mb-2 text-xl font-semibold text-gray-900 dark:text-gray-100",children:"No articles yet"}),f.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"This feed doesn't have any articles"})]}),!a&&d.length>0&&f.jsx("div",{className:"flex-1 overflow-y-auto",children:d.map(e=>f.jsx(se,{article:e,onClick:()=>{return t=e.id,void n(t);var t}},e.id))})]})}function ie(){const{articles:e,selectedArticleId:t,isLoading:r,error:a,setError:s,toggleArticleFavorite:n,selectArticle:i}=W(),o=e.find(e=>e.id===t);return r?f.jsx(K,{message:"Loading article..."}):t?o?f.jsxs("article",{className:"mx-auto h-full max-w-3xl overflow-y-auto px-6 py-8",children:[a&&f.jsx("div",{className:"mb-6",children:f.jsx(Z,{message:a,onDismiss:()=>s(null)})}),f.jsxs("button",{onClick:()=>{i(null)},className:"mb-4 flex items-center gap-2 text-gray-600 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-100 tablet:hidden",children:[f.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:f.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),f.jsx("span",{children:"返回文章列表"})]}),f.jsxs("header",{className:"mb-8",children:[f.jsxs("div",{className:"flex items-start justify-between gap-4 mb-4",children:[f.jsx("h1",{className:"text-3xl font-bold leading-tight text-gray-900 dark:text-gray-100 sm:text-4xl flex-1",children:o.title}),f.jsx("button",{onClick:()=>n(o.id),className:"shrink-0 p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",title:o.isFavorite?"取消收藏":"收藏文章",children:f.jsx("svg",{className:"h-6 w-6 "+(o.isFavorite?"text-yellow-500":"text-gray-400"),fill:o.isFavorite?"currentColor":"none",viewBox:"0 0 24 24",stroke:"currentColor",children:f.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"})})})]}),f.jsxs("div",{className:"flex flex-wrap items-center gap-3 text-sm text-gray-600 dark:text-gray-400",children:[o.author&&f.jsxs("span",{className:"font-medium",children:["By ",o.author]}),f.jsx("span",{children:"•"}),f.jsx("time",{dateTime:new Date(o.publishedAt).toISOString(),children:new Date(o.publishedAt).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})}),o.readAt&&f.jsxs(f.Fragment,{children:[f.jsx("span",{children:"•"}),f.jsxs("span",{className:"flex items-center gap-1",children:[f.jsxs("svg",{className:"h-4 w-4",fill:"currentColor",viewBox:"0 0 20 20",children:[f.jsx("path",{d:"M10 12a2 2 0 100-4 2 2 0 000 4z"}),f.jsx("path",{fillRule:"evenodd",d:"M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z",clipRule:"evenodd"})]}),"Read"]})]})]})]}),o.imageUrl&&f.jsx("figure",{className:"mb-8",children:f.jsx("img",{src:o.imageUrl,alt:o.title,className:"w-full rounded-lg object-cover",loading:"lazy"})}),f.jsx("div",{className:"prose prose-gray max-w-none dark:prose-invert prose-headings:font-semibold prose-a:text-primary prose-a:no-underline hover:prose-a:underline prose-img:rounded-lg",dangerouslySetInnerHTML:{__html:o.content||""}}),o.link&&f.jsx("footer",{className:"mt-8 border-t border-gray-200 pt-6 dark:border-gray-700",children:f.jsxs("a",{href:o.link,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-2 text-sm font-medium text-primary hover:underline",children:["Read original article",f.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:f.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})})]})})]}):f.jsx("div",{className:"p-8",children:f.jsx(Z,{message:"Article not found",onDismiss:()=>s(null)})}):f.jsxs("div",{className:"flex h-full flex-col items-center justify-center p-8 text-center",children:[f.jsx("svg",{className:"mb-4 h-16 w-16 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:f.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"})}),f.jsx("h2",{className:"mb-2 text-xl font-semibold text-gray-900 dark:text-gray-100",children:"No article selected"}),f.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Select an article to read"})]})}function oe(){const{isOnline:e}=J();return e?null:f.jsx("div",{role:"alert","aria-live":"polite",className:"fixed top-0 left-0 right-0 z-50 bg-yellow-500 dark:bg-yellow-600 text-gray-900 dark:text-white px-4 py-2 text-center shadow-md",children:f.jsxs("div",{className:"flex items-center justify-center gap-2",children:[f.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","aria-hidden":"true",children:f.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M18.364 5.636a9 9 0 010 12.728m0 0l-2.829-2.829m2.829 2.829L21 21M15.536 8.464a5 5 0 010 7.072m0 0l-2.829-2.829m-4.243 2.829a4.978 4.978 0 01-1.414-2.83m-1.414 5.658a9 9 0 01-2.167-9.238m7.824 2.167a1 1 0 111.414 1.414m-1.414-1.414L3 3m8.293 8.293l1.414 1.414"})}),f.jsx("span",{className:"font-medium text-sm",children:"You're offline - Showing cached content"})]})})}const le=[{label:"15 分钟",value:15},{label:"30 分钟",value:30},{label:"1 小时",value:60},{label:"2 小时",value:120},{label:"4 小时",value:240},{label:"手动刷新",value:0}],de=({value:e,onChange:t})=>f.jsxs("div",{className:"space-y-2",children:[f.jsx("label",{htmlFor:"refresh-interval",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"自动刷新间隔"}),f.jsx("select",{id:"refresh-interval",value:e,onChange:e=>t(Number(e.target.value)),className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white",children:le.map(e=>f.jsx("option",{value:e.value,children:e.label},e.value))}),f.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:0===e?"订阅源将不会自动刷新,需要手动刷新":`订阅源将每 ${e>=60?e/60+" 小时":`${e} 分钟`} 自动刷新`})]});function ce(){const{theme:e,setTheme:t}=X();return f.jsxs("div",{className:"space-y-2",children:[f.jsx("label",{htmlFor:"theme-selector",className:"block text-sm font-medium text-gray-900 dark:text-gray-100",children:"Theme"}),f.jsxs("select",{id:"theme-selector","data-testid":"theme-selector",value:e,onChange:e=>t(e.target.value),className:"block w-full rounded-lg border border-gray-300 bg-white px-4 py-2 text-gray-900 shadow-sm focus:border-blue-500 focus:ring-2 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-100",children:[f.jsx("option",{value:"system",children:"🌓 System Default"}),f.jsx("option",{value:"light",children:"☀️ Light"}),f.jsx("option",{value:"dark",children:"🌙 Dark"})]}),f.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"system"===e?"Automatically matches your system theme preference":`Using ${e} theme`})]})}async function ue(e,t){k.info("Importing feeds from OPML");const r=(new DOMParser).parseFromString(e,"text/xml"),a=r.querySelector("parsererror");if(a)throw new Error("Invalid OPML file: "+a.textContent);const s=me(r.querySelector("body")),n=[];function i(e,t){e.xmlUrl&&n.push({url:e.xmlUrl,category:t}),e.children&&e.children.forEach(t=>i(t,e.text))}s.forEach(e=>i(e)),k.info("Found feeds in OPML",{count:n.length});let o=0,l=0;const d=[],c=new Map,u=await L.getAll("categories"),m=new Set(u.map(e=>e.name));for(const{category:g}of n)if(g&&!c.has(g)&&!m.has(g)){const e={id:crypto.randomUUID(),name:g,order:u.length+c.size,createdAt:new Date};await L.put("categories",e),c.set(g,e.id),k.debug("Created category",{name:g})}for(let g=0;g<n.length;g++){const{url:e,category:r}=n[g];try{r&&c.get(r);k.debug("Importing feed",{url:e,category:r}),o++}catch(h){l++,d.push(`${e}: ${h instanceof Error?h.message:"Unknown error"}`),k.warn("Failed to import feed",{url:e,error:h})}t&&t(g+1,n.length)}return k.info("OPML import completed",{imported:o,failed:l}),{imported:o,failed:l,errors:d}}function me(e){if(!e)return[];const t=[];return e.querySelectorAll(":scope > outline").forEach(e=>{const r={text:e.getAttribute("text")||"",title:e.getAttribute("title")||void 0,xmlUrl:e.getAttribute("xmlUrl")||void 0,htmlUrl:e.getAttribute("htmlUrl")||void 0,type:e.getAttribute("type")||void 0},a=me(e);a.length>0&&(r.children=a),t.push(r)}),t}function he(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}function ge(){const[e,t]=r.useState(!1);return f.jsxs("button",{onClick:async()=>{t(!0);try{const e=await async function(){k.info("Exporting feeds to OPML");const e=await L.getAll("feeds"),t=await L.getAll("categories"),r=e.filter(e=>!e.deletedAt),a=new Map;r.forEach(e=>{const t=e.categoryId;a.has(t)||a.set(t,[]),a.get(t).push(e)});let s='<?xml version="1.0" encoding="UTF-8"?>\n';return s+='<opml version="2.0">\n',s+="  <head>\n",s+="    <title>RSS Reader Subscriptions</title>\n",s+=`    <dateCreated>${(new Date).toUTCString()}</dateCreated>\n`,s+="  </head>\n",s+="  <body>\n",t.forEach(e=>{const t=a.get(e.id)||[];0!==t.length&&(s+=`    <outline text="${he(e.name)}" title="${he(e.name)}">\n`,t.forEach(e=>{s+=`      <outline type="rss" text="${he(e.title)}" title="${he(e.title)}" xmlUrl="${he(e.url)}"`,e.link&&(s+=` htmlUrl="${he(e.link)}"`),s+=" />\n"}),s+="    </outline>\n")}),(a.get(void 0)||[]).forEach(e=>{s+=`    <outline type="rss" text="${he(e.title)}" title="${he(e.title)}" xmlUrl="${he(e.url)}"`,e.link&&(s+=` htmlUrl="${he(e.link)}"`),s+=" />\n"}),s+="  </body>\n",s+="</opml>",k.info("Exported OPML",{feedCount:r.length,categoryCount:t.length}),s}(),t=new Blob([e],{type:"text/xml"}),r=URL.createObjectURL(t),a=document.createElement("a");a.href=r,a.download=`rss-subscriptions-${(new Date).toISOString().split("T")[0]}.opml`,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(r),k.info("OPML exported successfully")}catch(e){k.error("Failed to export OPML",e instanceof Error?e:void 0),alert("Failed to export feeds. Please try again.")}finally{t(!1)}},disabled:e,className:"inline-flex items-center gap-2 rounded-lg bg-primary px-4 py-2 text-sm font-medium text-white hover:bg-primary/90 disabled:opacity-50",children:[f.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:f.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),e?"Exporting...":"Export OPML"]})}function fe(){const[e,t]=r.useState(!1),[a,s]=r.useState({current:0,total:0}),[n,i]=r.useState(null),o=r.useRef(null);return f.jsxs("div",{className:"space-y-3",children:[f.jsx("div",{className:"flex items-center gap-3",children:f.jsx("input",{ref:o,type:"file",accept:".opml,.xml",onChange:async e=>{var r;const a=null==(r=e.target.files)?void 0:r[0];if(a){t(!0),i(null),s({current:0,total:0});try{const e=await a.text(),t=await ue(e,(e,t)=>{s({current:e,total:t})});i(t),k.info("OPML import completed",t),t.imported>0&&setTimeout(()=>{window.location.reload()},2e3)}catch(n){k.error("Failed to import OPML",n instanceof Error?n:void 0),i({imported:0,failed:0,errors:[n instanceof Error?n.message:"Unknown error"]})}finally{t(!1),o.current&&(o.current.value="")}}},disabled:e,className:"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-medium file:bg-primary file:text-white hover:file:bg-primary/90 disabled:opacity-50"})}),e&&a.total>0&&f.jsxs("div",{className:"space-y-2",children:[f.jsxs("div",{className:"flex justify-between text-sm text-gray-600 dark:text-gray-400",children:[f.jsx("span",{children:"Importing feeds..."}),f.jsxs("span",{children:[a.current," / ",a.total]})]}),f.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 dark:bg-gray-700",children:f.jsx("div",{className:"bg-primary h-2 rounded-full transition-all",style:{width:a.current/a.total*100+"%"}})})]}),n&&f.jsxs("div",{className:"rounded-lg p-4 "+(n.errors.length>0?"bg-yellow-50 dark:bg-yellow-900/20 text-yellow-800 dark:text-yellow-200":"bg-green-50 dark:bg-green-900/20 text-green-800 dark:text-green-200"),children:[f.jsxs("p",{className:"font-medium",children:["Import completed: ",n.imported," successful, ",n.failed," failed"]}),n.errors.length>0&&f.jsxs("ul",{className:"mt-2 text-sm list-disc list-inside",children:[n.errors.slice(0,5).map((e,t)=>f.jsx("li",{children:e},t)),n.errors.length>5&&f.jsxs("li",{children:["...and ",n.errors.length-5," more errors"]})]})]})]})}const xe={id:"default",theme:"system",defaultRefreshIntervalMinutes:60,maxArticlesPerFeed:100,enableNotifications:!1,enableBackgroundSync:!0};function pe(){const[e,t]=r.useState(xe),[a,s]=r.useState(!1),[n,i]=r.useState(!1);r.useEffect(()=>{(async()=>{const e=await L.get("settings","default");e&&t(e)})()},[]);const o=async e=>{s(!0),i(!1);try{await L.put("settings",e),e.enableBackgroundSync&&e.defaultRefreshIntervalMinutes>0?await $.startAutoRefresh(e.defaultRefreshIntervalMinutes):$.stopAutoRefresh(),i(!0),setTimeout(()=>i(!1),2e3)}catch(t){}finally{s(!1)}};return f.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:f.jsxs("div",{className:"max-w-3xl mx-auto px-4 py-8",children:[f.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-8",children:"设置"}),f.jsxs("div",{className:"bg-white dark:bg-gray-800 shadow rounded-lg",children:[f.jsxs("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700",children:[f.jsx("h2",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4",children:"刷新设置"}),f.jsx(de,{value:e.defaultRefreshIntervalMinutes,onChange:async r=>{const a={...e,defaultRefreshIntervalMinutes:r};t(a),await o(a)}}),f.jsxs("div",{className:"mt-4",children:[f.jsxs("label",{className:"flex items-center",children:[f.jsx("input",{type:"checkbox",checked:e.enableBackgroundSync,onChange:async()=>{const r={...e,enableBackgroundSync:!e.enableBackgroundSync};t(r),await o(r)},className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500 dark:bg-gray-700 dark:border-gray-600"}),f.jsx("span",{className:"ml-2 text-sm text-gray-700 dark:text-gray-300",children:"启用后台同步"})]}),f.jsx("p",{className:"ml-6 text-sm text-gray-500 dark:text-gray-400 mt-1",children:"在后台自动刷新订阅源,即使应用关闭也会继续工作"})]})]}),f.jsxs("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700",children:[f.jsx("h2",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4",children:"主题"}),f.jsx(ce,{})]}),f.jsxs("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700",children:[f.jsx("h2",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4",children:"通知"}),f.jsxs("label",{className:"flex items-center",children:[f.jsx("input",{type:"checkbox",checked:e.enableNotifications,onChange:async()=>{const r={...e,enableNotifications:!e.enableNotifications};t(r),await o(r)},className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500 dark:bg-gray-700 dark:border-gray-600"}),f.jsx("span",{className:"ml-2 text-sm text-gray-700 dark:text-gray-300",children:"启用新文章通知"})]}),f.jsx("p",{className:"ml-6 text-sm text-gray-500 dark:text-gray-400 mt-1",children:"当订阅源有新文章时发送通知"})]}),f.jsxs("div",{className:"p-6",children:[f.jsx("h2",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4",children:"导入/导出"}),f.jsxs("div",{className:"space-y-4",children:[f.jsxs("div",{children:[f.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"导出订阅源"}),f.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-3",children:"将您的订阅源导出为 OPML 文件，以便备份或迁移到其他阅读器"}),f.jsx(ge,{})]}),f.jsxs("div",{children:[f.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"导入订阅源"}),f.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-3",children:"从 OPML 文件导入订阅源。支持从其他 RSS 阅读器导出的文件"}),f.jsx(fe,{})]})]})]})]}),n&&f.jsx("div",{className:"mt-4 p-4 bg-green-50 dark:bg-green-900/20 rounded-md",children:f.jsx("p",{className:"text-sm text-green-800 dark:text-green-200 text-center",children:"✓ 设置已保存"})}),a&&f.jsx("div",{className:"mt-4 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-md",children:f.jsx("p",{className:"text-sm text-blue-800 dark:text-blue-200 text-center",children:"保存中..."})})]})})}function ye(){const[e,t]=r.useState([]),[a,s]=r.useState(!0),{selectArticle:n,selectedArticleId:i}=W();r.useEffect(()=>{o()},[]);const o=async()=>{try{const e=(await L.getAll("articles")).filter(e=>e.isFavorite).sort((e,t)=>t.publishedAt.getTime()-e.publishedAt.getTime());t(e)}catch(e){}finally{s(!1)}};return i?f.jsx("div",{className:"max-w-4xl mx-auto p-6",children:f.jsxs("button",{onClick:()=>n(null),className:"mb-4 flex items-center gap-2 text-gray-600 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-100",children:[f.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:f.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),f.jsx("span",{children:"返回收藏列表"})]})}):a?f.jsx("div",{className:"p-8 text-center",children:"加载中..."}):0===e.length?f.jsxs("div",{className:"flex flex-col items-center justify-center py-16 text-center",children:[f.jsx("svg",{className:"mb-4 h-16 w-16 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:f.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"})}),f.jsx("h2",{className:"mb-2 text-xl font-semibold",children:"暂无收藏"}),f.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"点击文章上的收藏按钮来保存您喜欢的文章"})]}):f.jsxs("div",{className:"max-w-4xl mx-auto p-6",children:[f.jsxs("h1",{className:"text-2xl font-bold mb-6",children:["我的收藏 (",e.length,")"]}),f.jsx("div",{className:"space-y-4",children:e.map(e=>f.jsxs("article",{onClick:()=>n(e.id),className:"p-4 border rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800 cursor-pointer transition-colors",children:[f.jsx("h3",{className:"font-semibold mb-2",children:e.title}),e.summary&&f.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 line-clamp-2 mb-2",children:e.summary}),f.jsxs("div",{className:"flex items-center gap-4 text-xs text-gray-500",children:[f.jsx("span",{children:new Date(e.publishedAt).toLocaleDateString("zh-CN")}),e.author&&f.jsx("span",{children:e.author})]})]},e.id))})]})}function be(){const[e,t]=r.useState([]),[a,s]=r.useState(!0),{selectArticle:n,selectedArticleId:i}=W();r.useEffect(()=>{o()},[]);const o=async()=>{try{const e=(await L.getAll("articles")).filter(e=>e.readAt).sort((e,t)=>{const r=e.readAt?new Date(e.readAt).getTime():0;return(t.readAt?new Date(t.readAt).getTime():0)-r});t(e)}catch(e){}finally{s(!1)}};return i?f.jsx("div",{className:"max-w-4xl mx-auto p-6",children:f.jsxs("button",{onClick:()=>n(null),className:"mb-4 flex items-center gap-2 text-gray-600 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-100",children:[f.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:f.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),f.jsx("span",{children:"返回历史记录"})]})}):a?f.jsx("div",{className:"p-8 text-center",children:"加载中..."}):0===e.length?f.jsxs("div",{className:"flex flex-col items-center justify-center py-16 text-center",children:[f.jsx("svg",{className:"mb-4 h-16 w-16 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:f.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),f.jsx("h2",{className:"mb-2 text-xl font-semibold",children:"暂无历史记录"}),f.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"您阅读过的文章将显示在这里"})]}):f.jsxs("div",{className:"max-w-4xl mx-auto p-6",children:[f.jsxs("h1",{className:"text-2xl font-bold mb-6",children:["阅读历史 (",e.length,")"]}),f.jsx("div",{className:"space-y-4",children:e.map(e=>f.jsx("article",{onClick:()=>n(e.id),className:"p-4 border rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800 cursor-pointer transition-colors",children:f.jsxs("div",{className:"flex items-start justify-between gap-4",children:[f.jsxs("div",{className:"flex-1",children:[f.jsx("h3",{className:"font-semibold mb-2",children:e.title}),e.summary&&f.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 line-clamp-2 mb-2",children:e.summary}),f.jsxs("div",{className:"flex items-center gap-4 text-xs text-gray-500",children:[f.jsxs("span",{children:["阅读于: ",new Date(e.readAt).toLocaleString("zh-CN")]}),e.author&&f.jsx("span",{children:e.author})]})]}),e.isFavorite&&f.jsx("svg",{className:"h-5 w-5 text-yellow-500 shrink-0",fill:"currentColor",viewBox:"0 0 20 20",children:f.jsx("path",{d:"M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z"})})]})},e.id))})]})}const ve=new class{constructor(){t(this,"MAX_ARTICLES_PER_FEED",100),t(this,"MAX_TOTAL_ARTICLES",1e3),t(this,"DELETED_FEED_RETENTION_DAYS",7),t(this,"QUOTA_WARNING_THRESHOLD",.8),t(this,"QUOTA_CRITICAL_THRESHOLD",.9)}async checkQuota(){const e=await L.getQuota();e.percentUsed>100*this.QUOTA_CRITICAL_THRESHOLD?(k.warn("Storage quota critical",{usage:e.usage,quota:e.quota,percentUsed:e.percentUsed}),await this.performEmergencyCleanup()):e.percentUsed>100*this.QUOTA_WARNING_THRESHOLD&&k.info("Storage quota warning",{usage:e.usage,quota:e.quota,percentUsed:e.percentUsed})}async pruneArticles(){k.info("Pruning old articles");const e=await L.getAll("articles"),t=(await L.getAll("feeds")).filter(e=>!e.deletedAt);let r=0;for(const s of t){const t=e.filter(e=>e.feedId===s.id).sort((e,t)=>t.publishedAt.getTime()-e.publishedAt.getTime());if(t.length>this.MAX_ARTICLES_PER_FEED){const e=t.slice(this.MAX_ARTICLES_PER_FEED).filter(e=>!e.isFavorite&&null!==e.readAt);for(const t of e)await L.delete("articles",t.id),r++}}const a=await L.getAll("articles");if(a.length>this.MAX_TOTAL_ARTICLES){const e=a.filter(e=>!e.isFavorite&&null!==e.readAt).sort((e,t)=>t.publishedAt.getTime()-e.publishedAt.getTime()).slice(this.MAX_TOTAL_ARTICLES);for(const t of e)await L.delete("articles",t.id),r++}return k.info("Article pruning completed",{pruned:r}),r}async purgeDeletedFeeds(){k.info("Purging deleted feeds");const e=await L.getAll("feeds"),t=new Date,r=24*this.DELETED_FEED_RETENTION_DAYS*60*60*1e3;let a=0;for(const s of e)if(s.deletedAt){if(t.getTime()-s.deletedAt.getTime()>r){await L.delete("feeds",s.id);const e=await L.getAllByIndex("articles","feedId",s.id);for(const t of e)await L.delete("articles",t.id);a++,k.debug("Purged deleted feed",{feedId:s.id,title:s.title})}}return k.info("Deleted feed purge completed",{purged:a}),a}async performEmergencyCleanup(){k.warn("Performing emergency cleanup"),await this.purgeDeletedFeeds(),await this.pruneArticles();const e=await L.getQuota();e.percentUsed>100*this.QUOTA_CRITICAL_THRESHOLD&&k.error("Emergency cleanup insufficient",{percentUsed:e.percentUsed})}async getStats(){const e=await L.getAll("articles"),t=await L.getAll("feeds"),r=await L.getAll("categories"),a=await L.getQuota();return{totalArticles:e.length,totalFeeds:t.filter(e=>!e.deletedAt).length,totalCategories:r.length,deletedFeeds:t.filter(e=>e.deletedAt).length,favoriteArticles:e.filter(e=>e.isFavorite).length,unreadArticles:e.filter(e=>!e.readAt).length,storageUsed:a.usage,storageQuota:a.quota,percentUsed:a.percentUsed}}async runMaintenance(){k.info("Running cache maintenance"),await this.checkQuota(),await this.pruneArticles(),await this.purgeDeletedFeeds();const e=await this.getStats();k.info("Cache maintenance completed",e)}};function we(){const{resolvedTheme:e}=X(),{isOnline:t}=J(),[a,s]=r.useState(!1),[n,i]=r.useState("feeds"),{selectedFeedId:o,selectedArticleId:l,loadFeeds:d,articles:c}=W();return r.useEffect(()=>{(async()=>{try{await L.init(),s(!0),await d();const e=await L.get("settings","default");e&&e.enableBackgroundSync&&e.defaultRefreshIntervalMinutes>0&&(await $.startAutoRefresh(e.defaultRefreshIntervalMinutes),k.info("Auto-refresh started",{interval:e.defaultRefreshIntervalMinutes}))}catch(e){k.error("Failed to initialize app",e instanceof Error?e:void 0)}})()},[d]),r.useEffect(()=>{t&&a&&$.processQueuedOperations().catch(e=>{k.error("Failed to process queued operations",e instanceof Error?e:void 0)})},[t,a]),r.useEffect(()=>{if(!a)return;ve.runMaintenance().catch(e=>{k.error("Cache maintenance failed",e instanceof Error?e:void 0)});const e=setInterval(()=>{ve.runMaintenance().catch(e=>{k.error("Cache maintenance failed",e instanceof Error?e:void 0)})},216e5);return()=>clearInterval(e)},[a]),a?f.jsxs("div",{className:"min-h-screen transition-colors duration-200 "+("dark"===e?"bg-dark-950 text-white":"bg-white text-dark-900"),children:[f.jsx(oe,{}),f.jsx("div",{className:"fixed top-0 left-0 right-0 z-40 transition-colors "+(t?"bg-primary text-white":"bg-yellow-500 text-dark-950"),children:f.jsxs("div",{className:"flex items-center justify-between px-4 py-2",children:[f.jsxs("div",{className:"text-sm font-medium",children:["RSS阅读器 ",t?"✓":"⚠️"]}),f.jsxs("nav",{className:"flex gap-2",children:[f.jsx("button",{onClick:()=>i("feeds"),className:"text-sm font-medium px-3 py-1 rounded "+("feeds"===n?"bg-white/20":"hover:bg-white/10"),children:"订阅源"}),f.jsx("button",{onClick:()=>i("favorites"),className:"text-sm font-medium px-3 py-1 rounded "+("favorites"===n?"bg-white/20":"hover:bg-white/10"),children:"收藏"}),f.jsx("button",{onClick:()=>i("history"),className:"text-sm font-medium px-3 py-1 rounded "+("history"===n?"bg-white/20":"hover:bg-white/10"),children:"历史"}),f.jsx("button",{onClick:()=>i("settings"),className:"text-sm font-medium px-3 py-1 rounded "+("settings"===n?"bg-white/20":"hover:bg-white/10"),children:"设置"})]})]})}),f.jsx("div",{className:"pt-14",children:"settings"===n?f.jsx(pe,{}):"favorites"===n?l?f.jsx(ie,{}):f.jsx(ye,{}):"history"===n?l?f.jsx(ie,{}):f.jsx(be,{}):f.jsxs("div",{className:"grid grid-cols-1 tablet:grid-cols-12 gap-0 min-h-screen",children:[f.jsx("div",{className:(o?"hidden tablet:block":"")+" tablet:col-span-3 border-r border-gray-200 dark:border-dark-800 h-screen overflow-y-auto",children:f.jsx(ae,{})}),o&&f.jsx("div",{className:(l?"hidden tablet:block":"")+" tablet:col-span-4 border-r border-gray-200 dark:border-dark-800 h-screen",children:f.jsx(ne,{})}),l?f.jsx("div",{className:"tablet:col-span-5 h-screen",children:f.jsx(ie,{})}):o?f.jsx("div",{className:"hidden tablet:col-span-5 tablet:flex items-center justify-center text-gray-500 dark:text-gray-400 h-screen",children:f.jsx("p",{children:"Select an article to read"})}):f.jsx("div",{className:"hidden tablet:col-span-9 tablet:flex items-center justify-center text-gray-500 dark:text-gray-400 h-screen",children:f.jsx("p",{children:"Select a feed to get started"})})]})})]}):f.jsx("div",{className:"flex h-screen items-center justify-center "+("dark"===e?"bg-dark-950 text-white":"bg-white text-dark-900"),children:f.jsxs("div",{className:"text-center",children:[f.jsx("div",{className:"mb-4 h-12 w-12 animate-spin rounded-full border-4 border-primary border-t-transparent mx-auto"}),f.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Initializing..."})]})})}k.info("Application starting",{version:"1.0.0",environment:"production"});const je=function(e={}){const{immediate:t=!1,onNeedRefresh:r,onOfflineReady:a,onRegistered:s,onRegisteredSW:n,onRegisterError:i}=e;let o,l,d;return l=async function(){if("serviceWorker"in navigator){if(o=await z(async()=>{const{Workbox:e}=await import("./workbox-window.prod.es5-CLYUWRvB.js");return{Workbox:e}},[]).then(({Workbox:e})=>new e("/sw.js",{scope:"/",type:"classic"})).catch(e=>{null==i||i(e)}),!o)return;d=async()=>{await(null==o?void 0:o.messageSkipWaiting())};{let e=!1;const t=()=>{e=!0,null==o||o.addEventListener("controlling",e=>{e.isUpdate&&window.location.reload()}),null==r||r()};o.addEventListener("installed",r=>{void 0===r.isUpdate?void 0!==r.isExternal?r.isExternal?t():!e&&(null==a||a()):r.isExternal?window.location.reload():!e&&(null==a||a()):r.isUpdate||null==a||a()}),o.addEventListener("waiting",t),o.addEventListener("externalwaiting",t)}o.register({immediate:t}).then(e=>{n?n("/sw.js",e):null==s||s(e)}).catch(e=>{null==i||i(e)})}}(),async(e=!0)=>{await l,await(null==d?void 0:d())}}({immediate:!0,onNeedRefresh(){k.info("New content available; please refresh")},onOfflineReady(){k.info("App ready to work offline")},onRegistered(e){k.info("Service Worker registered",{scope:null==e?void 0:e.scope})},onRegisterError(e){k.error("Service Worker registration failed",{error:e})}});window.__updateSW=je,x.createRoot(document.getElementById("root")).render(f.jsx(n.StrictMode,{children:f.jsx(we,{})}));
